{"dependencies":[{"name":"../lib/constants","data":{"asyncType":null,"isESMImport":false,"locs":[{"start":{"line":3,"column":20,"index":97},"end":{"line":3,"column":47,"index":124}}],"key":"5SaJjHUOpKrE3J3aWh2RTsVAt6s=","exportNames":["*"],"imports":1}}],"output":[{"data":{"code":"__d(function (global, require, _$$_IMPORT_DEFAULT, _$$_IMPORT_ALL, module, exports, _dependencyMap) {\n  \"use strict\";\n\n  Object.defineProperty(exports, \"__esModule\", {\n    value: true\n  });\n  const constants_1 = require(_dependencyMap[0], \"../lib/constants\");\n  class Push {\n    /**\n     * Initializes the Push\n     *\n     * @param channel The Channel\n     * @param event The event, for example `\"phx_join\"`\n     * @param payload The payload, for example `{user_id: 123}`\n     * @param timeout The push timeout in milliseconds\n     */\n    constructor(channel, event, payload = {}, timeout = constants_1.DEFAULT_TIMEOUT) {\n      this.channel = channel;\n      this.event = event;\n      this.payload = payload;\n      this.timeout = timeout;\n      this.sent = false;\n      this.timeoutTimer = undefined;\n      this.ref = '';\n      this.receivedResp = null;\n      this.recHooks = [];\n      this.refEvent = null;\n    }\n    resend(timeout) {\n      this.timeout = timeout;\n      this._cancelRefEvent();\n      this.ref = '';\n      this.refEvent = null;\n      this.receivedResp = null;\n      this.sent = false;\n      this.send();\n    }\n    send() {\n      if (this._hasReceived('timeout')) {\n        return;\n      }\n      this.startTimeout();\n      this.sent = true;\n      this.channel.socket.push({\n        topic: this.channel.topic,\n        event: this.event,\n        payload: this.payload,\n        ref: this.ref,\n        join_ref: this.channel._joinRef()\n      });\n    }\n    updatePayload(payload) {\n      this.payload = Object.assign(Object.assign({}, this.payload), payload);\n    }\n    receive(status, callback) {\n      var _a;\n      if (this._hasReceived(status)) {\n        callback((_a = this.receivedResp) === null || _a === void 0 ? void 0 : _a.response);\n      }\n      this.recHooks.push({\n        status,\n        callback\n      });\n      return this;\n    }\n    startTimeout() {\n      if (this.timeoutTimer) {\n        return;\n      }\n      this.ref = this.channel.socket._makeRef();\n      this.refEvent = this.channel._replyEventName(this.ref);\n      const callback = payload => {\n        this._cancelRefEvent();\n        this._cancelTimeout();\n        this.receivedResp = payload;\n        this._matchReceive(payload);\n      };\n      this.channel._on(this.refEvent, {}, callback);\n      this.timeoutTimer = setTimeout(() => {\n        this.trigger('timeout', {});\n      }, this.timeout);\n    }\n    trigger(status, response) {\n      if (this.refEvent) this.channel._trigger(this.refEvent, {\n        status,\n        response\n      });\n    }\n    destroy() {\n      this._cancelRefEvent();\n      this._cancelTimeout();\n    }\n    _cancelRefEvent() {\n      if (!this.refEvent) {\n        return;\n      }\n      this.channel._off(this.refEvent, {});\n    }\n    _cancelTimeout() {\n      clearTimeout(this.timeoutTimer);\n      this.timeoutTimer = undefined;\n    }\n    _matchReceive({\n      status,\n      response\n    }) {\n      this.recHooks.filter(h => h.status === status).forEach(h => h.callback(response));\n    }\n    _hasReceived(status) {\n      return this.receivedResp && this.receivedResp.status === status;\n    }\n  }\n  exports.default = Push;\n});","lineCount":114,"map":[[2,2,1,0],[2,14,1,12],[4,2,2,0,"Object"],[4,8,2,6],[4,9,2,7,"defineProperty"],[4,23,2,21],[4,24,2,22,"exports"],[4,31,2,29],[4,33,2,31],[4,45,2,43],[4,47,2,45],[5,4,2,47,"value"],[5,9,2,52],[5,11,2,54],[6,2,2,59],[6,3,2,60],[6,4,2,61],[7,2,3,0],[7,8,3,6,"constants_1"],[7,19,3,17],[7,22,3,20,"require"],[7,29,3,27],[7,30,3,27,"_dependencyMap"],[7,44,3,27],[7,67,3,46],[7,68,3,47],[8,2,4,0],[8,8,4,6,"Push"],[8,12,4,10],[8,13,4,11],[9,4,5,4],[10,0,6,0],[11,0,7,0],[12,0,8,0],[13,0,9,0],[14,0,10,0],[15,0,11,0],[16,0,12,0],[17,4,13,4,"constructor"],[17,15,13,15,"constructor"],[17,16,13,16,"channel"],[17,23,13,23],[17,25,13,25,"event"],[17,30,13,30],[17,32,13,32,"payload"],[17,39,13,39],[17,42,13,42],[17,43,13,43],[17,44,13,44],[17,46,13,46,"timeout"],[17,53,13,53],[17,56,13,56,"constants_1"],[17,67,13,67],[17,68,13,68,"DEFAULT_TIMEOUT"],[17,83,13,83],[17,85,13,85],[18,6,14,8],[18,10,14,12],[18,11,14,13,"channel"],[18,18,14,20],[18,21,14,23,"channel"],[18,28,14,30],[19,6,15,8],[19,10,15,12],[19,11,15,13,"event"],[19,16,15,18],[19,19,15,21,"event"],[19,24,15,26],[20,6,16,8],[20,10,16,12],[20,11,16,13,"payload"],[20,18,16,20],[20,21,16,23,"payload"],[20,28,16,30],[21,6,17,8],[21,10,17,12],[21,11,17,13,"timeout"],[21,18,17,20],[21,21,17,23,"timeout"],[21,28,17,30],[22,6,18,8],[22,10,18,12],[22,11,18,13,"sent"],[22,15,18,17],[22,18,18,20],[22,23,18,25],[23,6,19,8],[23,10,19,12],[23,11,19,13,"timeoutTimer"],[23,23,19,25],[23,26,19,28,"undefined"],[23,35,19,37],[24,6,20,8],[24,10,20,12],[24,11,20,13,"ref"],[24,14,20,16],[24,17,20,19],[24,19,20,21],[25,6,21,8],[25,10,21,12],[25,11,21,13,"receivedResp"],[25,23,21,25],[25,26,21,28],[25,30,21,32],[26,6,22,8],[26,10,22,12],[26,11,22,13,"recHooks"],[26,19,22,21],[26,22,22,24],[26,24,22,26],[27,6,23,8],[27,10,23,12],[27,11,23,13,"refEvent"],[27,19,23,21],[27,22,23,24],[27,26,23,28],[28,4,24,4],[29,4,25,4,"resend"],[29,10,25,10,"resend"],[29,11,25,11,"timeout"],[29,18,25,18],[29,20,25,20],[30,6,26,8],[30,10,26,12],[30,11,26,13,"timeout"],[30,18,26,20],[30,21,26,23,"timeout"],[30,28,26,30],[31,6,27,8],[31,10,27,12],[31,11,27,13,"_cancelRefEvent"],[31,26,27,28],[31,27,27,29],[31,28,27,30],[32,6,28,8],[32,10,28,12],[32,11,28,13,"ref"],[32,14,28,16],[32,17,28,19],[32,19,28,21],[33,6,29,8],[33,10,29,12],[33,11,29,13,"refEvent"],[33,19,29,21],[33,22,29,24],[33,26,29,28],[34,6,30,8],[34,10,30,12],[34,11,30,13,"receivedResp"],[34,23,30,25],[34,26,30,28],[34,30,30,32],[35,6,31,8],[35,10,31,12],[35,11,31,13,"sent"],[35,15,31,17],[35,18,31,20],[35,23,31,25],[36,6,32,8],[36,10,32,12],[36,11,32,13,"send"],[36,15,32,17],[36,16,32,18],[36,17,32,19],[37,4,33,4],[38,4,34,4,"send"],[38,8,34,8,"send"],[38,9,34,8],[38,11,34,11],[39,6,35,8],[39,10,35,12],[39,14,35,16],[39,15,35,17,"_hasReceived"],[39,27,35,29],[39,28,35,30],[39,37,35,39],[39,38,35,40],[39,40,35,42],[40,8,36,12],[41,6,37,8],[42,6,38,8],[42,10,38,12],[42,11,38,13,"startTimeout"],[42,23,38,25],[42,24,38,26],[42,25,38,27],[43,6,39,8],[43,10,39,12],[43,11,39,13,"sent"],[43,15,39,17],[43,18,39,20],[43,22,39,24],[44,6,40,8],[44,10,40,12],[44,11,40,13,"channel"],[44,18,40,20],[44,19,40,21,"socket"],[44,25,40,27],[44,26,40,28,"push"],[44,30,40,32],[44,31,40,33],[45,8,41,12,"topic"],[45,13,41,17],[45,15,41,19],[45,19,41,23],[45,20,41,24,"channel"],[45,27,41,31],[45,28,41,32,"topic"],[45,33,41,37],[46,8,42,12,"event"],[46,13,42,17],[46,15,42,19],[46,19,42,23],[46,20,42,24,"event"],[46,25,42,29],[47,8,43,12,"payload"],[47,15,43,19],[47,17,43,21],[47,21,43,25],[47,22,43,26,"payload"],[47,29,43,33],[48,8,44,12,"ref"],[48,11,44,15],[48,13,44,17],[48,17,44,21],[48,18,44,22,"ref"],[48,21,44,25],[49,8,45,12,"join_ref"],[49,16,45,20],[49,18,45,22],[49,22,45,26],[49,23,45,27,"channel"],[49,30,45,34],[49,31,45,35,"_joinRef"],[49,39,45,43],[49,40,45,44],[50,6,46,8],[50,7,46,9],[50,8,46,10],[51,4,47,4],[52,4,48,4,"updatePayload"],[52,17,48,17,"updatePayload"],[52,18,48,18,"payload"],[52,25,48,25],[52,27,48,27],[53,6,49,8],[53,10,49,12],[53,11,49,13,"payload"],[53,18,49,20],[53,21,49,23,"Object"],[53,27,49,29],[53,28,49,30,"assign"],[53,34,49,36],[53,35,49,37,"Object"],[53,41,49,43],[53,42,49,44,"assign"],[53,48,49,50],[53,49,49,51],[53,50,49,52],[53,51,49,53],[53,53,49,55],[53,57,49,59],[53,58,49,60,"payload"],[53,65,49,67],[53,66,49,68],[53,68,49,70,"payload"],[53,75,49,77],[53,76,49,78],[54,4,50,4],[55,4,51,4,"receive"],[55,11,51,11,"receive"],[55,12,51,12,"status"],[55,18,51,18],[55,20,51,20,"callback"],[55,28,51,28],[55,30,51,30],[56,6,52,8],[56,10,52,12,"_a"],[56,12,52,14],[57,6,53,8],[57,10,53,12],[57,14,53,16],[57,15,53,17,"_hasReceived"],[57,27,53,29],[57,28,53,30,"status"],[57,34,53,36],[57,35,53,37],[57,37,53,39],[58,8,54,12,"callback"],[58,16,54,20],[58,17,54,21],[58,18,54,22,"_a"],[58,20,54,24],[58,23,54,27],[58,27,54,31],[58,28,54,32,"receivedResp"],[58,40,54,44],[58,46,54,50],[58,50,54,54],[58,54,54,58,"_a"],[58,56,54,60],[58,61,54,65],[58,66,54,70],[58,67,54,71],[58,70,54,74],[58,75,54,79],[58,76,54,80],[58,79,54,83,"_a"],[58,81,54,85],[58,82,54,86,"response"],[58,90,54,94],[58,91,54,95],[59,6,55,8],[60,6,56,8],[60,10,56,12],[60,11,56,13,"recHooks"],[60,19,56,21],[60,20,56,22,"push"],[60,24,56,26],[60,25,56,27],[61,8,56,29,"status"],[61,14,56,35],[62,8,56,37,"callback"],[63,6,56,46],[63,7,56,47],[63,8,56,48],[64,6,57,8],[64,13,57,15],[64,17,57,19],[65,4,58,4],[66,4,59,4,"startTimeout"],[66,16,59,16,"startTimeout"],[66,17,59,16],[66,19,59,19],[67,6,60,8],[67,10,60,12],[67,14,60,16],[67,15,60,17,"timeoutTimer"],[67,27,60,29],[67,29,60,31],[68,8,61,12],[69,6,62,8],[70,6,63,8],[70,10,63,12],[70,11,63,13,"ref"],[70,14,63,16],[70,17,63,19],[70,21,63,23],[70,22,63,24,"channel"],[70,29,63,31],[70,30,63,32,"socket"],[70,36,63,38],[70,37,63,39,"_makeRef"],[70,45,63,47],[70,46,63,48],[70,47,63,49],[71,6,64,8],[71,10,64,12],[71,11,64,13,"refEvent"],[71,19,64,21],[71,22,64,24],[71,26,64,28],[71,27,64,29,"channel"],[71,34,64,36],[71,35,64,37,"_replyEventName"],[71,50,64,52],[71,51,64,53],[71,55,64,57],[71,56,64,58,"ref"],[71,59,64,61],[71,60,64,62],[72,6,65,8],[72,12,65,14,"callback"],[72,20,65,22],[72,23,65,26,"payload"],[72,30,65,33],[72,34,65,38],[73,8,66,12],[73,12,66,16],[73,13,66,17,"_cancelRefEvent"],[73,28,66,32],[73,29,66,33],[73,30,66,34],[74,8,67,12],[74,12,67,16],[74,13,67,17,"_cancelTimeout"],[74,27,67,31],[74,28,67,32],[74,29,67,33],[75,8,68,12],[75,12,68,16],[75,13,68,17,"receivedResp"],[75,25,68,29],[75,28,68,32,"payload"],[75,35,68,39],[76,8,69,12],[76,12,69,16],[76,13,69,17,"_matchReceive"],[76,26,69,30],[76,27,69,31,"payload"],[76,34,69,38],[76,35,69,39],[77,6,70,8],[77,7,70,9],[78,6,71,8],[78,10,71,12],[78,11,71,13,"channel"],[78,18,71,20],[78,19,71,21,"_on"],[78,22,71,24],[78,23,71,25],[78,27,71,29],[78,28,71,30,"refEvent"],[78,36,71,38],[78,38,71,40],[78,39,71,41],[78,40,71,42],[78,42,71,44,"callback"],[78,50,71,52],[78,51,71,53],[79,6,72,8],[79,10,72,12],[79,11,72,13,"timeoutTimer"],[79,23,72,25],[79,26,72,28,"setTimeout"],[79,36,72,38],[79,37,72,39],[79,43,72,45],[80,8,73,12],[80,12,73,16],[80,13,73,17,"trigger"],[80,20,73,24],[80,21,73,25],[80,30,73,34],[80,32,73,36],[80,33,73,37],[80,34,73,38],[80,35,73,39],[81,6,74,8],[81,7,74,9],[81,9,74,11],[81,13,74,15],[81,14,74,16,"timeout"],[81,21,74,23],[81,22,74,24],[82,4,75,4],[83,4,76,4,"trigger"],[83,11,76,11,"trigger"],[83,12,76,12,"status"],[83,18,76,18],[83,20,76,20,"response"],[83,28,76,28],[83,30,76,30],[84,6,77,8],[84,10,77,12],[84,14,77,16],[84,15,77,17,"refEvent"],[84,23,77,25],[84,25,78,12],[84,29,78,16],[84,30,78,17,"channel"],[84,37,78,24],[84,38,78,25,"_trigger"],[84,46,78,33],[84,47,78,34],[84,51,78,38],[84,52,78,39,"refEvent"],[84,60,78,47],[84,62,78,49],[85,8,78,51,"status"],[85,14,78,57],[86,8,78,59,"response"],[87,6,78,68],[87,7,78,69],[87,8,78,70],[88,4,79,4],[89,4,80,4,"destroy"],[89,11,80,11,"destroy"],[89,12,80,11],[89,14,80,14],[90,6,81,8],[90,10,81,12],[90,11,81,13,"_cancelRefEvent"],[90,26,81,28],[90,27,81,29],[90,28,81,30],[91,6,82,8],[91,10,82,12],[91,11,82,13,"_cancelTimeout"],[91,25,82,27],[91,26,82,28],[91,27,82,29],[92,4,83,4],[93,4,84,4,"_cancelRefEvent"],[93,19,84,19,"_cancelRefEvent"],[93,20,84,19],[93,22,84,22],[94,6,85,8],[94,10,85,12],[94,11,85,13],[94,15,85,17],[94,16,85,18,"refEvent"],[94,24,85,26],[94,26,85,28],[95,8,86,12],[96,6,87,8],[97,6,88,8],[97,10,88,12],[97,11,88,13,"channel"],[97,18,88,20],[97,19,88,21,"_off"],[97,23,88,25],[97,24,88,26],[97,28,88,30],[97,29,88,31,"refEvent"],[97,37,88,39],[97,39,88,41],[97,40,88,42],[97,41,88,43],[97,42,88,44],[98,4,89,4],[99,4,90,4,"_cancelTimeout"],[99,18,90,18,"_cancelTimeout"],[99,19,90,18],[99,21,90,21],[100,6,91,8,"clearTimeout"],[100,18,91,20],[100,19,91,21],[100,23,91,25],[100,24,91,26,"timeoutTimer"],[100,36,91,38],[100,37,91,39],[101,6,92,8],[101,10,92,12],[101,11,92,13,"timeoutTimer"],[101,23,92,25],[101,26,92,28,"undefined"],[101,35,92,37],[102,4,93,4],[103,4,94,4,"_matchReceive"],[103,17,94,17,"_matchReceive"],[103,18,94,18],[104,6,94,20,"status"],[104,12,94,26],[105,6,94,28,"response"],[106,4,94,38],[106,5,94,39],[106,7,94,41],[107,6,95,8],[107,10,95,12],[107,11,95,13,"recHooks"],[107,19,95,21],[107,20,96,13,"filter"],[107,26,96,19],[107,27,96,21,"h"],[107,28,96,22],[107,32,96,27,"h"],[107,33,96,28],[107,34,96,29,"status"],[107,40,96,35],[107,45,96,40,"status"],[107,51,96,46],[107,52,96,47],[107,53,97,13,"forEach"],[107,60,97,20],[107,61,97,22,"h"],[107,62,97,23],[107,66,97,28,"h"],[107,67,97,29],[107,68,97,30,"callback"],[107,76,97,38],[107,77,97,39,"response"],[107,85,97,47],[107,86,97,48],[107,87,97,49],[108,4,98,4],[109,4,99,4,"_hasReceived"],[109,16,99,16,"_hasReceived"],[109,17,99,17,"status"],[109,23,99,23],[109,25,99,25],[110,6,100,8],[110,13,100,15],[110,17,100,19],[110,18,100,20,"receivedResp"],[110,30,100,32],[110,34,100,36],[110,38,100,40],[110,39,100,41,"receivedResp"],[110,51,100,53],[110,52,100,54,"status"],[110,58,100,60],[110,63,100,65,"status"],[110,69,100,71],[111,4,101,4],[112,2,102,0],[113,2,103,0,"exports"],[113,9,103,7],[113,10,103,8,"default"],[113,17,103,15],[113,20,103,18,"Push"],[113,24,103,22],[114,0,103,23],[114,3]],"functionMap":{"names":["<global>","Push","Push#constructor","Push#resend","Push#send","Push#updatePayload","Push#receive","Push#startTimeout","callback","setTimeout$argument_0","Push#trigger","Push#destroy","Push#_cancelRefEvent","Push#_cancelTimeout","Push#_matchReceive","recHooks.filter$argument_0","recHooks.filter.forEach$argument_0","Push#_hasReceived"],"mappings":"AAA;ACG;ICS;KDW;IEC;KFQ;IGC;KHa;IIC;KJE;IKC;KLO;IMC;yBCM;SDK;uCEE;SFE;KNC;ISC;KTG;IUC;KVG;IWC;KXK;IYC;KZG;IaC;oBCE,0BD;qBEC,2BF;KbC;IgBC;KhBE;CDC"},"hasCjsExports":true},"type":"js/module"}]}