{"dependencies":[{"name":"../lib/constants","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":1,"column":0,"index":0},"end":{"line":1,"column":51,"index":51}}],"key":"waQwSI03ELOcvO96++KD0MVyAp4=","exportNames":["*"],"imports":1}}],"output":[{"data":{"code":"__d(function (global, require, _$$_IMPORT_DEFAULT, _$$_IMPORT_ALL, module, exports, _dependencyMap) {\n  \"use strict\";\n\n  Object.defineProperty(exports, '__esModule', {\n    value: true\n  });\n  Object.defineProperty(exports, \"default\", {\n    enumerable: true,\n    get: function () {\n      return Push;\n    }\n  });\n  var _libConstants = require(_dependencyMap[0], \"../lib/constants\");\n  class Push {\n    /**\n     * Initializes the Push\n     *\n     * @param channel The Channel\n     * @param event The event, for example `\"phx_join\"`\n     * @param payload The payload, for example `{user_id: 123}`\n     * @param timeout The push timeout in milliseconds\n     */\n    constructor(channel, event, payload = {}, timeout = _libConstants.DEFAULT_TIMEOUT) {\n      this.channel = channel;\n      this.event = event;\n      this.payload = payload;\n      this.timeout = timeout;\n      this.sent = false;\n      this.timeoutTimer = undefined;\n      this.ref = '';\n      this.receivedResp = null;\n      this.recHooks = [];\n      this.refEvent = null;\n    }\n    resend(timeout) {\n      this.timeout = timeout;\n      this._cancelRefEvent();\n      this.ref = '';\n      this.refEvent = null;\n      this.receivedResp = null;\n      this.sent = false;\n      this.send();\n    }\n    send() {\n      if (this._hasReceived('timeout')) {\n        return;\n      }\n      this.startTimeout();\n      this.sent = true;\n      this.channel.socket.push({\n        topic: this.channel.topic,\n        event: this.event,\n        payload: this.payload,\n        ref: this.ref,\n        join_ref: this.channel._joinRef()\n      });\n    }\n    updatePayload(payload) {\n      this.payload = Object.assign(Object.assign({}, this.payload), payload);\n    }\n    receive(status, callback) {\n      var _a;\n      if (this._hasReceived(status)) {\n        callback((_a = this.receivedResp) === null || _a === void 0 ? void 0 : _a.response);\n      }\n      this.recHooks.push({\n        status,\n        callback\n      });\n      return this;\n    }\n    startTimeout() {\n      if (this.timeoutTimer) {\n        return;\n      }\n      this.ref = this.channel.socket._makeRef();\n      this.refEvent = this.channel._replyEventName(this.ref);\n      const callback = payload => {\n        this._cancelRefEvent();\n        this._cancelTimeout();\n        this.receivedResp = payload;\n        this._matchReceive(payload);\n      };\n      this.channel._on(this.refEvent, {}, callback);\n      this.timeoutTimer = setTimeout(() => {\n        this.trigger('timeout', {});\n      }, this.timeout);\n    }\n    trigger(status, response) {\n      if (this.refEvent) this.channel._trigger(this.refEvent, {\n        status,\n        response\n      });\n    }\n    destroy() {\n      this._cancelRefEvent();\n      this._cancelTimeout();\n    }\n    _cancelRefEvent() {\n      if (!this.refEvent) {\n        return;\n      }\n      this.channel._off(this.refEvent, {});\n    }\n    _cancelTimeout() {\n      clearTimeout(this.timeoutTimer);\n      this.timeoutTimer = undefined;\n    }\n    _matchReceive({\n      status,\n      response\n    }) {\n      this.recHooks.filter(h => h.status === status).forEach(h => h.callback(response));\n    }\n    _hasReceived(status) {\n      return this.receivedResp && this.receivedResp.status === status;\n    }\n  }\n});","lineCount":119,"map":[[7,2,2,15,"Object"],[7,8,2,15],[7,9,2,15,"defineProperty"],[7,23,2,15],[7,24,2,15,"exports"],[7,31,2,15],[8,4,2,15,"enumerable"],[8,14,2,15],[9,4,2,15,"get"],[9,7,2,15],[9,18,2,15,"get"],[9,19,2,15],[10,6,2,15],[10,13,2,15,"Push"],[10,17,2,15],[11,4,2,15],[12,2,2,15],[13,2,1,0],[13,6,1,0,"_libConstants"],[13,19,1,0],[13,22,1,0,"require"],[13,29,1,0],[13,30,1,0,"_dependencyMap"],[13,44,1,0],[14,2,2,15],[14,8,2,21,"Push"],[14,12,2,25],[14,13,2,26],[15,4,3,4],[16,0,4,0],[17,0,5,0],[18,0,6,0],[19,0,7,0],[20,0,8,0],[21,0,9,0],[22,0,10,0],[23,4,11,4,"constructor"],[23,15,11,15,"constructor"],[23,16,11,16,"channel"],[23,23,11,23],[23,25,11,25,"event"],[23,30,11,30],[23,32,11,32,"payload"],[23,39,11,39],[23,42,11,42],[23,43,11,43],[23,44,11,44],[23,46,11,46,"timeout"],[23,53,11,53],[23,56,11,56,"DEFAULT_TIMEOUT"],[23,69,11,71],[23,70,11,71,"DEFAULT_TIMEOUT"],[23,85,11,71],[23,87,11,73],[24,6,12,8],[24,10,12,12],[24,11,12,13,"channel"],[24,18,12,20],[24,21,12,23,"channel"],[24,28,12,30],[25,6,13,8],[25,10,13,12],[25,11,13,13,"event"],[25,16,13,18],[25,19,13,21,"event"],[25,24,13,26],[26,6,14,8],[26,10,14,12],[26,11,14,13,"payload"],[26,18,14,20],[26,21,14,23,"payload"],[26,28,14,30],[27,6,15,8],[27,10,15,12],[27,11,15,13,"timeout"],[27,18,15,20],[27,21,15,23,"timeout"],[27,28,15,30],[28,6,16,8],[28,10,16,12],[28,11,16,13,"sent"],[28,15,16,17],[28,18,16,20],[28,23,16,25],[29,6,17,8],[29,10,17,12],[29,11,17,13,"timeoutTimer"],[29,23,17,25],[29,26,17,28,"undefined"],[29,35,17,37],[30,6,18,8],[30,10,18,12],[30,11,18,13,"ref"],[30,14,18,16],[30,17,18,19],[30,19,18,21],[31,6,19,8],[31,10,19,12],[31,11,19,13,"receivedResp"],[31,23,19,25],[31,26,19,28],[31,30,19,32],[32,6,20,8],[32,10,20,12],[32,11,20,13,"recHooks"],[32,19,20,21],[32,22,20,24],[32,24,20,26],[33,6,21,8],[33,10,21,12],[33,11,21,13,"refEvent"],[33,19,21,21],[33,22,21,24],[33,26,21,28],[34,4,22,4],[35,4,23,4,"resend"],[35,10,23,10,"resend"],[35,11,23,11,"timeout"],[35,18,23,18],[35,20,23,20],[36,6,24,8],[36,10,24,12],[36,11,24,13,"timeout"],[36,18,24,20],[36,21,24,23,"timeout"],[36,28,24,30],[37,6,25,8],[37,10,25,12],[37,11,25,13,"_cancelRefEvent"],[37,26,25,28],[37,27,25,29],[37,28,25,30],[38,6,26,8],[38,10,26,12],[38,11,26,13,"ref"],[38,14,26,16],[38,17,26,19],[38,19,26,21],[39,6,27,8],[39,10,27,12],[39,11,27,13,"refEvent"],[39,19,27,21],[39,22,27,24],[39,26,27,28],[40,6,28,8],[40,10,28,12],[40,11,28,13,"receivedResp"],[40,23,28,25],[40,26,28,28],[40,30,28,32],[41,6,29,8],[41,10,29,12],[41,11,29,13,"sent"],[41,15,29,17],[41,18,29,20],[41,23,29,25],[42,6,30,8],[42,10,30,12],[42,11,30,13,"send"],[42,15,30,17],[42,16,30,18],[42,17,30,19],[43,4,31,4],[44,4,32,4,"send"],[44,8,32,8,"send"],[44,9,32,8],[44,11,32,11],[45,6,33,8],[45,10,33,12],[45,14,33,16],[45,15,33,17,"_hasReceived"],[45,27,33,29],[45,28,33,30],[45,37,33,39],[45,38,33,40],[45,40,33,42],[46,8,34,12],[47,6,35,8],[48,6,36,8],[48,10,36,12],[48,11,36,13,"startTimeout"],[48,23,36,25],[48,24,36,26],[48,25,36,27],[49,6,37,8],[49,10,37,12],[49,11,37,13,"sent"],[49,15,37,17],[49,18,37,20],[49,22,37,24],[50,6,38,8],[50,10,38,12],[50,11,38,13,"channel"],[50,18,38,20],[50,19,38,21,"socket"],[50,25,38,27],[50,26,38,28,"push"],[50,30,38,32],[50,31,38,33],[51,8,39,12,"topic"],[51,13,39,17],[51,15,39,19],[51,19,39,23],[51,20,39,24,"channel"],[51,27,39,31],[51,28,39,32,"topic"],[51,33,39,37],[52,8,40,12,"event"],[52,13,40,17],[52,15,40,19],[52,19,40,23],[52,20,40,24,"event"],[52,25,40,29],[53,8,41,12,"payload"],[53,15,41,19],[53,17,41,21],[53,21,41,25],[53,22,41,26,"payload"],[53,29,41,33],[54,8,42,12,"ref"],[54,11,42,15],[54,13,42,17],[54,17,42,21],[54,18,42,22,"ref"],[54,21,42,25],[55,8,43,12,"join_ref"],[55,16,43,20],[55,18,43,22],[55,22,43,26],[55,23,43,27,"channel"],[55,30,43,34],[55,31,43,35,"_joinRef"],[55,39,43,43],[55,40,43,44],[56,6,44,8],[56,7,44,9],[56,8,44,10],[57,4,45,4],[58,4,46,4,"updatePayload"],[58,17,46,17,"updatePayload"],[58,18,46,18,"payload"],[58,25,46,25],[58,27,46,27],[59,6,47,8],[59,10,47,12],[59,11,47,13,"payload"],[59,18,47,20],[59,21,47,23,"Object"],[59,27,47,29],[59,28,47,30,"assign"],[59,34,47,36],[59,35,47,37,"Object"],[59,41,47,43],[59,42,47,44,"assign"],[59,48,47,50],[59,49,47,51],[59,50,47,52],[59,51,47,53],[59,53,47,55],[59,57,47,59],[59,58,47,60,"payload"],[59,65,47,67],[59,66,47,68],[59,68,47,70,"payload"],[59,75,47,77],[59,76,47,78],[60,4,48,4],[61,4,49,4,"receive"],[61,11,49,11,"receive"],[61,12,49,12,"status"],[61,18,49,18],[61,20,49,20,"callback"],[61,28,49,28],[61,30,49,30],[62,6,50,8],[62,10,50,12,"_a"],[62,12,50,14],[63,6,51,8],[63,10,51,12],[63,14,51,16],[63,15,51,17,"_hasReceived"],[63,27,51,29],[63,28,51,30,"status"],[63,34,51,36],[63,35,51,37],[63,37,51,39],[64,8,52,12,"callback"],[64,16,52,20],[64,17,52,21],[64,18,52,22,"_a"],[64,20,52,24],[64,23,52,27],[64,27,52,31],[64,28,52,32,"receivedResp"],[64,40,52,44],[64,46,52,50],[64,50,52,54],[64,54,52,58,"_a"],[64,56,52,60],[64,61,52,65],[64,66,52,70],[64,67,52,71],[64,70,52,74],[64,75,52,79],[64,76,52,80],[64,79,52,83,"_a"],[64,81,52,85],[64,82,52,86,"response"],[64,90,52,94],[64,91,52,95],[65,6,53,8],[66,6,54,8],[66,10,54,12],[66,11,54,13,"recHooks"],[66,19,54,21],[66,20,54,22,"push"],[66,24,54,26],[66,25,54,27],[67,8,54,29,"status"],[67,14,54,35],[68,8,54,37,"callback"],[69,6,54,46],[69,7,54,47],[69,8,54,48],[70,6,55,8],[70,13,55,15],[70,17,55,19],[71,4,56,4],[72,4,57,4,"startTimeout"],[72,16,57,16,"startTimeout"],[72,17,57,16],[72,19,57,19],[73,6,58,8],[73,10,58,12],[73,14,58,16],[73,15,58,17,"timeoutTimer"],[73,27,58,29],[73,29,58,31],[74,8,59,12],[75,6,60,8],[76,6,61,8],[76,10,61,12],[76,11,61,13,"ref"],[76,14,61,16],[76,17,61,19],[76,21,61,23],[76,22,61,24,"channel"],[76,29,61,31],[76,30,61,32,"socket"],[76,36,61,38],[76,37,61,39,"_makeRef"],[76,45,61,47],[76,46,61,48],[76,47,61,49],[77,6,62,8],[77,10,62,12],[77,11,62,13,"refEvent"],[77,19,62,21],[77,22,62,24],[77,26,62,28],[77,27,62,29,"channel"],[77,34,62,36],[77,35,62,37,"_replyEventName"],[77,50,62,52],[77,51,62,53],[77,55,62,57],[77,56,62,58,"ref"],[77,59,62,61],[77,60,62,62],[78,6,63,8],[78,12,63,14,"callback"],[78,20,63,22],[78,23,63,26,"payload"],[78,30,63,33],[78,34,63,38],[79,8,64,12],[79,12,64,16],[79,13,64,17,"_cancelRefEvent"],[79,28,64,32],[79,29,64,33],[79,30,64,34],[80,8,65,12],[80,12,65,16],[80,13,65,17,"_cancelTimeout"],[80,27,65,31],[80,28,65,32],[80,29,65,33],[81,8,66,12],[81,12,66,16],[81,13,66,17,"receivedResp"],[81,25,66,29],[81,28,66,32,"payload"],[81,35,66,39],[82,8,67,12],[82,12,67,16],[82,13,67,17,"_matchReceive"],[82,26,67,30],[82,27,67,31,"payload"],[82,34,67,38],[82,35,67,39],[83,6,68,8],[83,7,68,9],[84,6,69,8],[84,10,69,12],[84,11,69,13,"channel"],[84,18,69,20],[84,19,69,21,"_on"],[84,22,69,24],[84,23,69,25],[84,27,69,29],[84,28,69,30,"refEvent"],[84,36,69,38],[84,38,69,40],[84,39,69,41],[84,40,69,42],[84,42,69,44,"callback"],[84,50,69,52],[84,51,69,53],[85,6,70,8],[85,10,70,12],[85,11,70,13,"timeoutTimer"],[85,23,70,25],[85,26,70,28,"setTimeout"],[85,36,70,38],[85,37,70,39],[85,43,70,45],[86,8,71,12],[86,12,71,16],[86,13,71,17,"trigger"],[86,20,71,24],[86,21,71,25],[86,30,71,34],[86,32,71,36],[86,33,71,37],[86,34,71,38],[86,35,71,39],[87,6,72,8],[87,7,72,9],[87,9,72,11],[87,13,72,15],[87,14,72,16,"timeout"],[87,21,72,23],[87,22,72,24],[88,4,73,4],[89,4,74,4,"trigger"],[89,11,74,11,"trigger"],[89,12,74,12,"status"],[89,18,74,18],[89,20,74,20,"response"],[89,28,74,28],[89,30,74,30],[90,6,75,8],[90,10,75,12],[90,14,75,16],[90,15,75,17,"refEvent"],[90,23,75,25],[90,25,76,12],[90,29,76,16],[90,30,76,17,"channel"],[90,37,76,24],[90,38,76,25,"_trigger"],[90,46,76,33],[90,47,76,34],[90,51,76,38],[90,52,76,39,"refEvent"],[90,60,76,47],[90,62,76,49],[91,8,76,51,"status"],[91,14,76,57],[92,8,76,59,"response"],[93,6,76,68],[93,7,76,69],[93,8,76,70],[94,4,77,4],[95,4,78,4,"destroy"],[95,11,78,11,"destroy"],[95,12,78,11],[95,14,78,14],[96,6,79,8],[96,10,79,12],[96,11,79,13,"_cancelRefEvent"],[96,26,79,28],[96,27,79,29],[96,28,79,30],[97,6,80,8],[97,10,80,12],[97,11,80,13,"_cancelTimeout"],[97,25,80,27],[97,26,80,28],[97,27,80,29],[98,4,81,4],[99,4,82,4,"_cancelRefEvent"],[99,19,82,19,"_cancelRefEvent"],[99,20,82,19],[99,22,82,22],[100,6,83,8],[100,10,83,12],[100,11,83,13],[100,15,83,17],[100,16,83,18,"refEvent"],[100,24,83,26],[100,26,83,28],[101,8,84,12],[102,6,85,8],[103,6,86,8],[103,10,86,12],[103,11,86,13,"channel"],[103,18,86,20],[103,19,86,21,"_off"],[103,23,86,25],[103,24,86,26],[103,28,86,30],[103,29,86,31,"refEvent"],[103,37,86,39],[103,39,86,41],[103,40,86,42],[103,41,86,43],[103,42,86,44],[104,4,87,4],[105,4,88,4,"_cancelTimeout"],[105,18,88,18,"_cancelTimeout"],[105,19,88,18],[105,21,88,21],[106,6,89,8,"clearTimeout"],[106,18,89,20],[106,19,89,21],[106,23,89,25],[106,24,89,26,"timeoutTimer"],[106,36,89,38],[106,37,89,39],[107,6,90,8],[107,10,90,12],[107,11,90,13,"timeoutTimer"],[107,23,90,25],[107,26,90,28,"undefined"],[107,35,90,37],[108,4,91,4],[109,4,92,4,"_matchReceive"],[109,17,92,17,"_matchReceive"],[109,18,92,18],[110,6,92,20,"status"],[110,12,92,26],[111,6,92,28,"response"],[112,4,92,38],[112,5,92,39],[112,7,92,41],[113,6,93,8],[113,10,93,12],[113,11,93,13,"recHooks"],[113,19,93,21],[113,20,94,13,"filter"],[113,26,94,19],[113,27,94,21,"h"],[113,28,94,22],[113,32,94,27,"h"],[113,33,94,28],[113,34,94,29,"status"],[113,40,94,35],[113,45,94,40,"status"],[113,51,94,46],[113,52,94,47],[113,53,95,13,"forEach"],[113,60,95,20],[113,61,95,22,"h"],[113,62,95,23],[113,66,95,28,"h"],[113,67,95,29],[113,68,95,30,"callback"],[113,76,95,38],[113,77,95,39,"response"],[113,85,95,47],[113,86,95,48],[113,87,95,49],[114,4,96,4],[115,4,97,4,"_hasReceived"],[115,16,97,16,"_hasReceived"],[115,17,97,17,"status"],[115,23,97,23],[115,25,97,25],[116,6,98,8],[116,13,98,15],[116,17,98,19],[116,18,98,20,"receivedResp"],[116,30,98,32],[116,34,98,36],[116,38,98,40],[116,39,98,41,"receivedResp"],[116,51,98,53],[116,52,98,54,"status"],[116,58,98,60],[116,63,98,65,"status"],[116,69,98,71],[117,4,99,4],[118,2,100,0],[119,0,100,1],[119,3]],"functionMap":{"names":["<global>","Push","Push#constructor","Push#resend","Push#send","Push#updatePayload","Push#receive","Push#startTimeout","callback","setTimeout$argument_0","Push#trigger","Push#destroy","Push#_cancelRefEvent","Push#_cancelTimeout","Push#_matchReceive","recHooks.filter$argument_0","recHooks.filter.forEach$argument_0","Push#_hasReceived"],"mappings":"AAA;eCC;ICS;KDW;IEC;KFQ;IGC;KHa;IIC;KJE;IKC;KLO;IMC;yBCM;SDK;uCEE;SFE;KNC;ISC;KTG;IUC;KVG;IWC;KXK;IYC;KZG;IaC;oBCE,0BD;qBEC,2BF;KbC;IgBC;KhBE;CDC"},"hasCjsExports":false},"type":"js/module"}]}